import qiniu from 'qiniu';
import Image from "next/image";
import { useState } from "react";
import {version} from '../package.json'

export const getServerSideProps = (async () => {
  const { AccessKey, SecretKey} = process.env;
  const windowsKey = `Ngroker-Windows-${version}-Setup.exe`;
  const macKey = `Ngroker-Mac-${version}-Installer.dmg`
  const mac = new qiniu.auth.digest.Mac(AccessKey, SecretKey);
  const config = new qiniu.conf.Config();
  const bucketManager = new qiniu.rs.BucketManager(mac, config);
  const privateBucketDomain = 'http://cdn.ngroker.com';
  const deadline = parseInt(Date.now() / 1000) + 1800; // 半小时过期
  const windowsDownloadUrl = bucketManager.privateDownloadUrl(privateBucketDomain, windowsKey, deadline);
  const macDownloadUrl = bucketManager.privateDownloadUrl(privateBucketDomain, macKey, deadline);

return { props: {
windowsDownloadUrl,
macDownloadUrl,
} }
})

export default function Home({
  windowsDownloadUrl,
macDownloadUrl,
}) {
  const [platform, setPlatform] = useState("windows")
  useEffect(() => {
    const {userAgent} = navigator;
    const isWindows = userAgent.indexOf('Windows') > -1
    const isMac = userAgent.indexOf('Macintosh') > -1
    if(isWindows){
      setPlatform("windows")
    }
    if(isMac){
      setPlatform("mac")
    }
  },[])

return (

<div className="container-fluid h-full grid place-content-center">
  <div className="p-4 sm:p-6 md:p-8 flex gap-4 sm:gap-6 md:gap-8 flex-col sm:flex-row items-center rounded-2xl border border-[rgba(224,243,255,0.1)]">
    <div className="basis-full sm:basis-1/3 gap-4 flex flex-col justify-center">
      <strong>
        Ngroker is amazingly simple to use. Get authtoken from{" "}
        <a
          target="_blank"
          href="https://dashboard.ngrok.com/get-started/your-authtoken"
        >
          ngrok
        </a>{" "}
        and your development life will become easy.
      </strong>
      <a
        type="button"
        href={platform === "windows" ? windowsDownloadUrl : macDownloadUrl}
        className="no-underline justify-center flex gap-4 rounded-xl px-6 py-3.5 text-base font-medium text-white bg-gradient-to-br from-purple-600 to-blue-500 hover:bg-gradient-to-bl focus:ring-4 focus:outline-none focus:ring-blue-300 dark:focus:ring-blue-800"
      >
        <span>Download for {platform}</span>
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinecap="round"
          strokeLinejoin="round"
        >
          <path d="M12 17V3" />
          <path d="m6 11 6 6 6-6" />
          <path d="M19 21H5" />
        </svg>
      </a>
      <small className="text-center">
        <ul className="list-none">
          <li>Auto Dark Mode</li>
          <li>Internationalization</li>
          <li>Compatible with ngrok</li>
        </ul>
      </small>
    </div>
    <div className="basis-full sm:basis-2/3">
      <Image
        alt="ngroker download"
        src="/screenshots/tunnel-sessions.png"
        width={1283}
        height={820}
      />
    </div>
  </div>
</div>

);
}
import { useEffect } from "react"
import { platform } from "os"
